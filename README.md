# üîê Secure Access to AWS Secrets Manager using IAM & STS

This project demonstrates **secure access control to AWS Secrets Manager secrets** using **temporary credentials generated via AWS STS (Security Token Service)**. Secrets are encrypted with KMS (Key Management Service) and accessed using fine-grained IAM roles or user permissions.

---

## üß† Overview

- **Goal:** Access AWS Secrets Manager secrets securely using IAM credentials and STS temporary tokens.
- **Secrets Manager:** Stores sensitive credentials such as database passwords, API keys, etc. Secrets are encrypted with a KMS key.
- **Access Control:** Controlled via IAM users/roles and policies (principle of least privilege).
- **Language:** Python (uses `boto3` and `botocore`).
- **Input:** Credentials loaded from `creds.txt`.
- **Output:** Lists available secrets in Secrets Manager and retrieves the selected secret securely.

---

## üß∞ Prerequisites

Before running the script, ensure you have:

- AWS account with a configured **KMS key** and **Secrets Manager secrets**.
- IAM user or IAM role with permissions for:
  - `secretsmanager:ListSecrets`
  - `secretsmanager:GetSecretValue`
  - `secretsmanager:DescribeSecret`
  - `kms:Decrypt`
  - `sts:AssumeRole` (if using a role for temporary credentials)
- Python 3.x installed.
- `boto3` and `botocore` libraries installed:

```bash
pip install boto3 botocore

```

---

## ‚öôÔ∏è Setup Instructions

### 1Ô∏è‚É£ Clone or Download this Repository

```bash
git clone https://github.com/<your-username>/<repo-name>.git
cd <repo-name>

```

### 2Ô∏è‚É£ Configure Credentials

Create a file named `creds.txt` in the same directory as the script:

```
AWS_ACCESS_KEY_ID=<YOUR_ACCESS_KEY_ID>
AWS_SECRET_ACCESS_KEY=<YOUR_SECRET_ACCESS_KEY>
AWS_REGION=<YOUR_AWS_REGION>
ASSUME_ROLE_ARN=<OPTIONAL_ROLE_ARN>

```

> üí° ASSUME_ROLE_ARN is optional.
> 
> - If provided, the script will **assume the role** and use **temporary credentials** via STS.
> - If not specified, it will use the **static credentials** directly.

---

## üöÄ How to Run

Run the script from your terminal:

```bash
python secrets-reader.py

```

### What it does:

1. Loads AWS credentials from `creds.txt`.
2. Initializes a base session using those credentials.
3. (Optional) Assumes the IAM role if `ASSUME_ROLE_ARN` is specified, obtaining **temporary credentials**.
4. Lists all available **Secrets Manager secrets** accessible to the session.
5. Prompts you to select a secret by name or number.
6. Retrieves and displays the **secret value securely**.

---

## üß© Example Output

```
Available Secrets in Secrets Manager:
1. MyAppSecret
2. DatabasePassword

Enter secret name (or number) to retrieve: 1

Secret Retrieved Successfully!
Secret Name: MyAppSecret
Secret Value: {"username":"dbadmin","password":"StrongPass123"}

```

---

## üõ°Ô∏è Security Notes

- Avoid committing your actual `creds.txt` to GitHub ‚Äî add it to `.gitignore`.
- Use **IAM roles** (EC2, Lambda, etc.) instead of hardcoding credentials where possible.
- Keep **least privilege policies** for KMS and Secrets Manager access.
- Enable **CloudTrail** for auditing secret access events.
- Temporary credentials generated by STS **expire automatically**, reducing long-term risk.

---

## üìú Example IAM Policy

Attach this policy to your IAM user or role to grant access to specific secrets and the KMS key:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "secretsmanager:GetSecretValue",
        "secretsmanager:ListSecrets",
        "secretsmanager:DescribeSecret"
      ],
      "Resource": "arn:aws:secretsmanager:ap-south-1:111122223333:secret:MyAppSecret-*"
    },
    {
      "Effect": "Allow",
      "Action": "kms:Decrypt",
      "Resource": "arn:aws:kms:ap-south-1:111122223333:key/your-key-id"
    },
    {
      "Effect": "Allow",
      "Action": "sts:AssumeRole",
      "Resource": "arn:aws:iam::991046440595:role/secrets-reader-role"
    }
  ]
}

```

---

## üë• Team Members

| Name | Role |
| --- | --- |
| User 1 | IAM User 1 / Team Member |
| User 2 | IAM User 2 / Team Member |
| User 3 | IAM User 3 / Team Member |

Each user should have unique access credentials to test secure access.

---

## üßæ License

This project is for **educational and security demonstration purposes only**.

Ensure all credentials and AWS resources are managed responsibly.
